<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø©">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #16213e;
            --secondary: #0f3460;
            --accent: #e94560;
            --accent-light: #ff6b6b;
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --success: #00d9a5;
            --warning: #ffc107;
            --shadow: 0 10px 40px rgba(0,0,0,0.3);
            --radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; }

        /* Animated Background */
        .bg-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .bg-animation::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at 20% 80%, var(--accent) 0%, transparent 25%), radial-gradient(circle at 80% 20%, var(--secondary) 0%, transparent 25%), radial-gradient(circle at 40% 40%, #4a00e0 0%, transparent 30%); animation: bgMove 20s ease-in-out infinite; opacity: 0.15; }
        @keyframes bgMove { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 33% { transform: translate(30px, -30px) rotate(5deg); } 66% { transform: translate(-20px, 20px) rotate(-5deg); } }

        /* Header */
        .header { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); padding: 20px; text-align: center; position: relative; overflow: hidden; }
        .header::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--accent-light), var(--accent)); }
        .header h1 { font-size: 1.8rem; font-weight: 800; margin-bottom: 5px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 0.9rem; color: var(--text-secondary); }

        /* Debug Log */
        #debug-log { 
            direction: ltr; text-align: left; font-family: monospace; 
            font-size: 12px; margin: 10px; padding: 10px; border-radius: 8px; display: none;
        }

        /* Container */
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }

        /* Search */
        .search-section { background: var(--bg-card); border-radius: var(--radius); padding: 25px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,0.05); }
        .search-box { position: relative; margin-bottom: 15px; }
        .search-box input { width: 100%; padding: 18px 50px 18px 20px; border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; background: rgba(255,255,255,0.05); color: var(--text-primary); font-size: 1.1rem; font-family: 'Tajawal', sans-serif; transition: all 0.3s ease; }
        .search-box input:focus { outline: none; border-color: var(--accent); background: rgba(255,255,255,0.08); box-shadow: 0 0 20px rgba(233, 69, 96, 0.2); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; fill: var(--accent); }

        /* Stats */
        .stats-section { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-card); border-radius: var(--radius); padding: 20px 15px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-number { font-size: 1.8rem; font-weight: 800; background: linear-gradient(135deg, var(--accent), var(--accent-light)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px; }

        /* Results */
        .results-section { margin-top: 20px; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 5px; }
        .results-count { font-size: 0.9rem; color: var(--text-secondary); }
        .results-count span { color: var(--accent); font-weight: 700; }

        /* Student Card */
        .student-card { background: var(--bg-card); border-radius: var(--radius); padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); box-shadow: var(--shadow); animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .student-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .student-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent-light)); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: 800; color: white; flex-shrink: 0; }
        .student-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 3px; }
        .student-id { font-size: 0.85rem; color: var(--text-secondary); }
        
        .student-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .detail-item { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 10px; }
        .detail-label { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px; }
        .detail-value { font-size: 0.9rem; font-weight: 600; }

        /* Manual Upload Button */
        .manual-upload-btn {
            display: block; width: 100%; padding: 12px; margin-top: 10px;
            background: rgba(255,255,255,0.1); border: 1px dashed var(--accent);
            color: var(--text-secondary); border-radius: 8px; cursor: pointer; text-align: center;
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <header class="header">
        <h1>ğŸ“ Ù†Ø¸Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø©</h1>
        <p>Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</p>
    </header>

    <div id="debug-log"></div>

    <main class="container">
        <section class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ...">
                <svg class="search-icon" viewBox="0 0 24 24">
                    <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                </svg>
            </div>
            
            <label for="csvFile" class="manual-upload-btn">ğŸ“‚ Ø¥Ø°Ø§ Ù„Ù… ØªØ¸Ù‡Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</label>
            <input type="file" id="csvFile" accept=".csv" style="display: none;">
        </section>

        <section class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="totalStudents">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="resultsCount">0</div>
                <div class="stat-label">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</div>
            </div>
        </section>

        <section class="results-section">
            <div id="studentsList"></div>
        </section>
    </main>

    <script>
        // === Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ´Ø®ÙŠØµÙŠ ÙˆØ§Ù„Ø¨Ø­Ø« ===
        
        let students = [];
        const debugEl = document.getElementById("debug-log");
        const studentsList = document.getElementById('studentsList');
        const totalEl = document.getElementById('totalStudents');
        const countEl = document.getElementById('resultsCount');

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© (Ù„Ù„ØªØ´Ø®ÙŠØµ)
        function logToScreen(level, msg) {
            console.log(msg);
            if (!debugEl) return;
            debugEl.style.display = "block";
            debugEl.style.background = level === 'error' ? '#ffe8e8' : '#e9f3ff';
            debugEl.style.color = level === 'error' ? '#7a0000' : '#003b73';
            debugEl.textContent = msg;
        }

        // Ø¯Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†ØµÙˆØµ
        function normalize(s) {
            return (s ?? "").toString().trim().toLowerCase().replace(/\u200f|\u200e/g, "");
        }

        // 1. ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
        document.addEventListener('DOMContentLoaded', () => {
            loadCSVWithFallback();
        });

        // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function loadCSVWithFallback() {
            logToScreen('info', 'Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ data.csv...');
            
            // Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„ÙƒØ§Ø´
            const url = `data.csv?t=${Date.now()}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const text = await response.text();
                processData(text);
                logToScreen('info', 'âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                setTimeout(() => { debugEl.style.display = 'none'; }, 3000); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            } catch (err) {
                logToScreen('error', `âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ: ${err.message}. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ.`);
            }
        }

        // 3. Ù…Ø¹Ø§Ù„Ø¬Ø© CSV
        function processData(text) {
            // Ø­Ø°Ù BOM
            text = text.replace(/^\uFEFF/, '');
            
            const lines = text.split(/\r?\n/);
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ù…Ù„ÙÙƒ: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø±Ù‚Ù…ØŒ Ø§Ù„ØµÙØŒ Ø§Ù„Ø´Ø¹Ø¨Ø©ØŒ Ø§Ù„Ø¬Ù†Ø³ÙŠØ©)
            // Ø³Ù†ÙØªØ±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
            
            const data = [];
            let headers = [];
            
            // CSV Parser Ø¨Ø³ÙŠØ·
            lines.forEach((line, idx) => {
                if (!line.trim()) return;
                // ØªÙ‚Ø³ÙŠÙ… Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„ÙÙˆØ§ØµÙ„
                const row = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/^"|"$/g, '').trim());
                
                if (idx === 0) {
                    headers = row;
                } else {
                    // Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù…Ù„ÙÙƒ)
                    // Ø§Ù„ÙÙ‡Ø±Ø³: 0=Ø§Ù„Ø§Ø³Ù…, 1=Ø§Ù„Ø±Ù‚Ù…, 2=Ø§Ù„ØµÙ, 3=Ø§Ù„Ø´Ø¹Ø¨Ø©, 4=Ø§Ù„Ø¬Ù†Ø³ÙŠØ© (Ø­Ø³Ø¨ Ù…Ù„ÙÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚)
                    if (row.length > 1) {
                        data.push({
                            name: row[0] || "",
                            id: row[1] || "",
                            grade: row[2] || "",    // Ø§Ù„ØµÙ
                            section: row[3] || "",  // Ø§Ù„Ø´Ø¹Ø¨Ø©
                            nat: row[4] || ""       // Ø§Ù„Ø¬Ù†Ø³ÙŠØ©
                        });
                    }
                }
            });

            students = data;
            totalEl.textContent = students.length;
            renderStudents(students.slice(0, 50)); // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50
        }

        // 4. Ø±Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (ØªØµÙ…ÙŠÙ…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
        function renderStudents(list) {
            countEl.textContent = list.length;
            
            if (list.length === 0) {
                studentsList.innerHTML = `
                    <div style="text-align:center; padding:40px; color:#aaa;">
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
                    </div>`;
                return;
            }

            studentsList.innerHTML = list.map((s, index) => `
                <div class="student-card" style="animation-delay: ${index * 0.05}s">
                    <div class="student-header">
                        <div class="student-avatar">${s.name.charAt(0)}</div>
                        <div>
                            <div class="student-name">${s.name}</div>
                            <div class="student-id">Ø§Ù„Ø±Ù‚Ù…: ${s.id}</div>
                        </div>
                    </div>
                    <div class="student-details">
                        <div class="detail-item">
                            <div class="detail-label">Ø§Ù„ØµÙ</div>
                            <div class="detail-value" style="color:var(--warning)">${s.grade}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ø§Ù„Ø´Ø¹Ø¨Ø©</div>
                            <div class="detail-value">${s.section}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</div>
                            <div class="detail-value" style="color:var(--success)">${s.nat}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 5. Ø§Ù„Ø¨Ø­Ø«
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => {
            const q = normalize(e.target.value);
            if (!q) {
                renderStudents(students.slice(0, 50));
                return;
            }
            const filtered = students.filter(s => 
                normalize(s.name).includes(q) || normalize(s.id).includes(q)
            );
            renderStudents(filtered);
        });

        // 6. Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
        document.getElementById('csvFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (evt) => processData(evt.target.result);
            reader.readAsText(file);
        });

    </script>
</body>
</html>
